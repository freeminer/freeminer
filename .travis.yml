language: cpp

compiler:
  - gcc
  # TODO: "ambiguous conversion for functional-style cast
  # from 'long' to 'core::stringc' (aka 'string<c8>')"
  #- clang

os:
  - linux
  - osx

matrix:
  fast_finish: true

addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test    # for gcc-4.8
      - llvm-toolchain-precise-3.7 # for clang
    packages:
      - clang
      - cmake
      - doxygen
      - g++-4.8
      - gcc-4.8
      - gettext
      - libbz2-dev
      - libgettextpo0
      - libgl1-mesa-dev
      - libirrlicht-dev
      - libjpeg8-dev
      - libleveldb-dev
      - libogg-dev
      - libopenal-dev
      - libpng12-dev
      - libsnappy-dev
      - libsqlite3-dev
      - libvorbis-dev
      - libxxf86vm-dev
      - llvm-3.7

before_install:
  - brew update
  - brew install gettext irrlicht libogg

before_install:
  - if [ $CC = 'gcc' ]; then
      export CC='gcc-4.8';
      export CXX='g++-4.8';
      export LINK='gcc-4.8';
      export LINKXX='g++-4.8';
    fi
  - if [ "$CXX" == "clang++" ]; then
      cpwd=$(pwd);
      export CXXFLAGS="-std=c++0x -stdlib=libc++";
      svn co --quiet http://llvm.org/svn/llvm-project/libcxx/trunk libcxx;
      cd libcxx/lib && bash buildit;
      sudo cp ./libc++.so.1.0 /usr/lib/;
      sudo mkdir /usr/include/c++/v1;
      cd .. && sudo cp -r include/* /usr/include/c++/v1/;
      cd /usr/lib && sudo ln -sf libc++.so.1.0 libc++.so;
      sudo ln -sf libc++.so.1.0 libc++.so.1 && cd $cwd;
      export CC=$(which clang);
      export CXX=$(which clang++);
      cd "$cpwd";
    fi
  #- git submodule update --init --recursive&

script:
  - mkdir -p _build
  - cd _build
  - if [ $TRAVIS_OS_NAME == "linux" ]; then
      cmake -DENABLE_GETTEXT=1 ..;
      sudo make -j3 install;
    else
      cmake .. -DGETTEXT_LIBRARY=/usr/local/opt/gettext/lib/libgettextlib.dylib -DGETTEXT_INCLUDE_DIR=/usr/local/opt/gettext/include;
      make -j3 package;
    fi

notifications:
  email: false
